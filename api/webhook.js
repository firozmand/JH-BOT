// api/webhook.js

const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config(); // ุจุงุฑฺฏุฐุงุฑ ูุชุบุฑูุง ูุญุท ุงุฒ ูุงู .env

// --- ุชูุธูุงุช ---
// ุงู ููุงุฏุฑ ุงุฒ .env (ุฏุฑ ุชูุณุนู ููฺฉุงู) ุง ุงุฒ Environment Variables ุฏุฑ Vercel ุฎูุงูุฏู ูโุดููุฏ.
const TOKEN = process.env.TELEGRAM_BOT_TOKEN;
const WEBHOOK_BASE_URL = process.env.WEBHOOK_URL; // URL ุงุตู ูพุฑูฺู Vercel ุดูุง
const BOT_USERNAME = process.env.BOT_USERNAME; // ูุฒุฑูู ุจุงุช ุดูุง (ุจุฏูู @)
const CHANNEL_USERNAME = process.env.CHANNEL_USERNAME; // ูุฒุฑูู ฺฉุงูุงู ุดูุง (ุจุฏูู @)

// ุงุนุชุจุงุฑุณูุฌ ุงููู ุจุฑุง ูุชุบุฑูุง ูุญุท ุญุงุช
if (!TOKEN || !WEBHOOK_BASE_URL || !BOT_USERNAME || !CHANNEL_USERNAME) {
    console.error('โ ฺฉ ุง ฺูุฏ ูุชุบุฑ ูุญุท ุญุงุช ูพุฏุง ูุดุฏูุฏ!');
    console.error('ูุทูุงู ูุทูุฆู ุดูุฏ TELEGRAM_BOT_TOKEN, WEBHOOK_URL, BOT_USERNAME, ู CHANNEL_USERNAME ุชูุธู ุดุฏูโุงูุฏ.');
    // ุฏุฑ ูุญุท Vercelุ ุงฺฏุฑ ุงููุง ูุจุงุดูุฏุ ูุนูููุงู ฺฉ ุฎุทุง ุชูุธูุงุช ุงุณุช.
}

// ฺฉ ููููู ุฌุฏุฏ ุงุฒ ุจุงุช ุชูฺฏุฑุงู ุงุฌุงุฏ ฺฉูุฏ.
// ูฺฉุชู ููู: ุจุฑุง Serverless Functions ุฏุฑ Vercelุ ุงุฒ polling: true ุงุณุชูุงุฏู ูฺฉูุฏ.
// ุจุงุช ุจูโุฑูุฒุฑุณุงูโูุง ุฑุง ุงุฒ ุทุฑู ูุจโููฺฉ ุฏุฑุงูุช ุฎูุงูุฏ ฺฉุฑุฏ.
const bot = new TelegramBot(TOKEN);

// --- ุฏุงุฏูโูุง ุจุงุฒ (ุญููุช ู ุฌุฑุฃุช) ---
const truths = [
    'ุขุฎุฑู ุฏุฑูุบ ฺฉู ฺฏูุช ฺ ุจูุฏูุ',
    'ุชุง ุญุงูุง ฺฉุณ ุฑู ุฏูุณุช ุฏุงุดุช ฺฉู ูุจุงุฏุ',
    'ุจุฒุฑฺฏุชุฑู ุชุฑุณุช ฺูุ',
    'ุชุง ุญุงูุง ุจู ฺฉุณ ฺฉู ุชู ุงู ุฌูุน ูุณุช ุนูุงูู ุฏุงุดุชุ',
    'ุงููู ุจูุณูโุงุช ฺูโุฌูุฑ ุจูุฏุ',
    'ุชุง ุญุงูุง ุนุงุดู ฺฉุณ ุดุฏ ฺฉู ุจูุช ุชูุฌู ูฺฉุฑุฏู ุจุงุดูุ',
    'ุชุง ุญุงูุง ุจู ุจูุชุฑู ุฏูุณุชุช ุงุนุชุฑุงู ุนุดู ฺฉุฑุฏุ',
    'ุชุง ุญุงูุง ุจู ุฎุงุทุฑ ฺฉุณ ฺฉู ุนุงุดูุด ุจูุฏ ู ุฑุงุจุทู ุฑู ุชููู ฺฉุฑุฏุ',
    'ุชุง ุญุงูุง ุจู ฺฉุณ ฺฉู ุฏูุณุชุด ุฏุงุดุช ุญุณูุฏ ฺฉุฑุฏุ ฺุฑุงุ',
    'ุดุฑูโุขูุฑุชุฑู ุงุชูุงู ฺฉู ุชู ู ุฑุงุจุทู ุจุฑุงุช ุงูุชุงุฏู ฺ ุจูุฏูุ',
    'ุชุง ุญุงูุง ุจู ฺฉุณ ฺฉู ูโุฏูู ุนูุงููโุง ุจูุช ูุฏุงุฑูุ ุงุจุฑุงุฒ ุนูุงูู ฺฉุฑุฏุ',
    'ฺฉุซูโุชุฑู ุฏุฑูุบ ฺฉู ุจู ฺฉุณ ฺฏูุช ฺ ุจูุฏูุ',
    'ุชุง ุญุงูุง ฺฉุณ ุฑู ุจูุณุฏ ฺฉู ุจุนุฏุด ูพุดููู ุดุฏู ุจุงุดุ',
    'ุฎุฌุงูุชโุขูุฑุชุฑู ฺุฒ ฺฉู ูุงูุฏูุช ุงุฒุช ุฏุฏู ฺ ุจูุฏูุ',
    'ุชุง ุญุงูุง ุงุฒ ุฑู ุญุณุงุฏุช ุจู ฺฉุณ ุชููุช ุฒุฏุ',
    'ุชุง ุญุงูุง ุดุฏู ุชู ู ููููู ุง ุฌูุน ยซฺุดูโฺุฑููยป ฺฉูุ',
    'ุชุง ุญุงูุง ุดุฏู ุชู ุฑุงุจุทูโุง ุจุงุด ฺฉู ููุท ุจู ุฎุงุทุฑ ูุณุงุฆู ุฎุงุต ุงุฏุงูู ุฏุงุฏุ',
    'ูุงุฌูุฑุชุฑู ฺุฒ ฺฉู ุชุง ุญุงูุง ุชู ุฐููุช ุฏุงุดุช ูู ูฺฏูุช ฺ ุจูุฏูุ',
    'ุชุง ุญุงูุง ุดุฏู ุชู ู ูุฑุงุฑุ ุจุฎูุง ุฎู ุฒูุฏุชุฑ ุงุฒ ุงููุฌุง ุจุฒู ุจุฑูู ูู ูุชููุ',
    'ุงฺฏู ูุฑุฏุง ุตุจุญ ุจุฏุงุฑ ุจุด ุจุจู ุฌูุณุชุช ุนูุถ ุดุฏู ุงููู ฺฉุงุฑ ฺฉู ูโฺฉู ฺูุ',
    'ุชู ุงู ุงุชุงู ุงุฒ ฺฉ ุจุดุชุฑ ุฎูุดุช ูุงุฏุ',
    'ุชู ุงู ุงุชุงู ุงุฒ ฺฉ ุจุดุชุฑ ุจุฏุช ูุงุฏุ',
    'ุงฺฏุฑ ูุฑุงุฑ ุจุงุดู ูุฑุฏุง ุฏูุง ุจู ูพุงุงู ุจุฑุณู ุงูุงู ฺฺฉุงุฑ ูโฺฉูุ',
    'ุงฺฏู ุฏูุณุช ุตููุช ุงุฒ ูพุณุฑ ฺฉู ุฏูุณุด ุฏุงุฑ ุฎูุดุด ุจุงุฏ ฺฺฉุงุฑ ูโฺฉูุ',
    'ุชู ุฌุฐุงุจุชุฑ ุง ุจูุชุฑู ุฏูุณุชุชุ',
    'ุงฺฏู ูุฌุจูุฑ ุจุงุด ููู ุฑู ุจุจุฎุด ุบุฑ ุงุฒ ฺฉ ููุฑุ ุงูู ฺฉ ููุฑ ฺฉู ููโุจุฎุด ฺฉูุ',
    'ูุฌุงูโุงูฺฏุฒุชุฑู ุฎูุงู ฺฉู ฺฉุฑุฏ ฺ ุจูุฏุ',
    'ฺู ุฑูุง ุฎุงุต ุฏุฑ ุณุฑ ุฏุงุฑุ',
    'ุชุง ุญุงูุง ุฑุงุฒ ุฏูุณุชุงุช ุฑู ุจู ฺฉุณ ฺฏูุชุ',
    'ุชู ุฒูุฏฺฏุช ุจู ฺฉ ุจุดุชุฑ ุงุฒ ููู ุญุณุงุฏุช ฺฉุฑุฏุ',
    'ูุนุงุฑุช ุจุฑุง ูพุงุฑุชูุฑ ุฑูุงูุงุช ฺูุ',
    'ูุฌุงูโุงูฺฏุฒุชุฑู ุงุชูุงู ุฒูุฏฺฏุช ฺ ุจูุฏุ',
    'ฺฉุฑุงุดุช ฺฉูุ',
    'ูพูุฌ ุชุง ุงุฒ ุฌุฐุงุจโุชุฑู ุฏุฎุชุฑูุง ฺฉู ูโุดูุงุณ ุฑู ูุงู ุจุจุฑ',
    'ุงฺฏู ููุท ฺฉ ฺุฒ ุฑู ูโุชููุณุช ุจุฏูู ูุญุฏูุฏุช ูุงู ุจุฎุฑุ ุงูู ฺ ุจูุฏุ',
    'ุงฺฏู ุจูุช ุจฺฏู ูุฌุจูุฑ ููู ุฑู ุจุจุฎุด ุบุฑ ุงุฒ ฺฉ ููุฑุ ุงูู ฺฉ ููุฑ ฺฉู ููโุจุฎุด ฺฉูุ',
    'ุจู ูพุงุฑุชูุฑุช ุจฺฏู ฺฉู ุจูุชุฑู ูฺฺฏโุงุด ฺฉู ุชู ุฑู ุฌุฐุจ ฺฉุฑุฏู ฺู',
    'ุชุง ุญุงูุง ููุงุฏ ูุฎุฏุฑ ูุตุฑู ฺฉุฑุฏุ',
    'ุฏูุณุช ุฏุงุฑ ฺ ุฏุฑ ูุฎุงุทุจ ุฎุงุตุช ุชุบุฑ ฺฉููุ',
    'ุฏูุณุช ุฏุงุฑ ฺูุฏุชุง ุจฺู ุฏุงุดุชู ุจุงุดุ',
    'ูููโุชุฑู ูุงุงูู ฺฉู ุชู ุฑุงุจุทู ุญุณ ูโฺฉู ฺูุ',
    'ุจุฑุง ุงูฺฉู ุฌุฐุงุจ ุจู ูุธุฑ ุจุฑุณ ฺฺฉุงุฑ ูโฺฉูุ',
    'ุฌุฐุงุจโุชุฑู ูฺฺฏ ูุฑุฏูุง/ุฒูโูุง ฺูุ',
    'ุงฺฏู ูโุดุฏ ูพุณุฑ/ุฏุฎุชุฑ (ุฌูุณ ูุฎุงูู) ุจุด ุจุง ฺฉ ูโุฑูุช ุชู ุฑุงุจุทูุ',
    'ุฌุฐุงุจโุชุฑู ุฌูุณ ูุฎุงูู ฺฉู ูโุดูุงุณ ฺฉูุ',
    'ุขุฎุฑู ุจุงุฑ ฺฉู ฺฏุฑู ฺฉุฑุฏ ฺฉ ุจูุฏุ ุจู ุฎุงุทุฑ ฺุ',
    'ุชุง ุญุงูุง ุฏุฑ ูฺฏุงู ุงูู ุนุงุดู ุดุฏุ',
    'ุจู ุฌุฐุงุจุช ู ุฒุจุง ุฎูุฏุช ุงุฒ 10 ฺู ููุฑูโุง ูโุฏุ',
    'ุฏูุณุช ุฏุงุฑ ฺุทูุฑ ุจูุฑุ'
];

const dares = [
    'ุดุฑูโุขูุฑุชุฑู ุนฺฉุณ ุฑุง ุฏุฑ ฺฏุงูุฑ ุฎูุฏ ุจู ูุง ูุดุงู ุฏูุฏ.',
    'ุจุฒุฑฺฏุชุฑู ุขุฑูุบ ุฑุง ฺฉู ูโุชูุงูุฏ ุจุฑูู ุจฺฏุฐุงุฑุฏ.',
    'ฺฉ ููุฒ ุฑุง ุจู ุงุบูุงฺฉููุฏูโุชุฑู ุดฺฉู ฺฉู ูโุชูุงูุฏ ุจุฎูุฑุฏ.',
    'ฺฉ ูุงุณุงฺ ูพูุฌ ุฏูููโุง ูพุง ุจู ูู ุจุฏูุฏ.',
    'ุจุฐุงุฑ 5 ุฏููู ูุฑฺฉุงุฑ ูโุฎูุงู ุจุง ฺฏูุดุช ุงูุฌุงู ุจุฏู.',
    '15 ุจุงุฑ ุฏูุฑ ุฎูุฏ ุจฺุฑุฎุฏ ู ุณูพุณ ุณุน ฺฉูุฏ ูุจโูุง ูุฑุง ุจุจูุณุฏ.',
    'ฺฉุซูโุชุฑู ุฑุงุฒุช ุฑุง ุฏุฑ ฺฏูุด ูู ุจฺฏู.',
    'ฺฉ ุชฺฉู ูููู ุจุฒุฑฺฏ ุจุฎูุฑ.',
    'ฺฉ ูุงุดู ฺฉุฑู ุจุฎูุฑ.',
    'ฺฉ ูุทุนู ุฎ ุฏุฑ ุดููุงุฑ ุฎูุฏ ูุฑุงุฑ ุจุฏู ู ุตุจุฑ ฺฉู ุชุง ุขุจ ุดูุฏ.',
    'ุงุฌุงุฒู ุจุฏู ุดุฑฺฉุชโฺฉููุฏูโูุง ุชู ุฑุง ุขุฑุงุด ฺฉููุฏ (ูุฎุตูุต ูพุณุฑูุง).',
    'ุขุฑุงุดุช ุฑุง ูพุงฺฉ ฺฉู (ูุฎุตูุต ุฏุฎุชุฑูุง).',
    'ูุจุงุณ ุฏุฎุชุฑููู ุจูพูุด ู ุนฺฉุณ ุจฺฏุฑ.',
    'ูุจุงุณ ูพุณุฑููู ุจูพูุด ู ุนฺฉุณ ุจฺฏุฑ.',
    'ุฏุณุช ุฎูุฏ ุฑุง ุชุง ุขุฑูุฌ ุฏุงุฎู ุณุทู ุฒุจุงูู ูุฑู ุจุจุฑ.',
    'ูุงู ุฎูุฏ ุฑุง ุจุง ุฒุจุงู ุฑู ุฒูู ุจููุณ.',
    'ููพ ุดุฑฺฉุชโฺฉููุฏู ุณูุช ุฑุงุณุช ุฎูุฏ ุฑุง ุจุจูุณ.',
    'ุฌูุฑุงุจ ุจุบูโุฏุณุช ุฎูุฏ ุฑุง ุชุง ูพุงุงู ุจุงุฒ ูุงููุฏ ุฏุณุชฺฉุด ุงุณุชูุงุฏู ฺฉู.',
    'ุจู ุจุงูุง ูพุดุช ุจุงู ุจุฑู ู ูุฑุงุฏ ุจุฒู ูู ุจฺู ุณุฑ ุฑุงู ูุณุชู.',
    'ฺฉุงุบุฐ ุดฺฉูุงุช ุฑุง ุชููุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏูุงู ุฎูุฏ ุจุงุฒ ฺฉู.',
    'ุจุง ุฏุณุชโูุง ุฎูุฏ ุงุฒ ฺฉ ุทุฑู ุงุชุงู ุจู ุทุฑู ุฏฺฏุฑ ุจุฑูุ ุจูุชุฑ ุงุณุช ฺฉ ุงุฒ ุดุฑฺฉุชโฺฉููุฏฺฏุงู ูพุงูุง ุฑุง ุจุงูุง ูฺฏู ุฏุงุฑุฏ.',
    'ฺฉ ุนุฏุฏ ูพุงุฒ ุฎุงู ุจุฎูุฑ ู ฺฏุฑู ูฺฉู.',
    'ุนฺฉุณ ฺฉุงุฑุช ูู ุฌุฏุฏุช ุฑุง ุฏุฑ ูพุฑููุงู ุฎูุฏ ูุฑุงุฑ ุจุฏู.',
    'ฺูุงุฑ ุชฺฉู ุงุฒ ูุจุงุณโูุงุช ุฑุง ุจุง ุดุฑฺฉุชโฺฉููุฏู ุณูุช ุฑุงุณุชุช ุนูุถ ฺฉู.',
    'ุชููู ููุฑุงู ุฎูุฏ ุฑุง ุจู ฺฉ ุงุฒ ุดุฑฺฉุชโฺฉููุฏฺฏุงู ุจุฏู ุชุง ฺฉ ูพุงู ุจุฑุง ูุฑ ฺฉุณ ฺฉู ุฏุฑ ูุณุช ุชูุงุณโูุง ุงุณุช ุงุฑุณุงู ฺฉูุฏ.',
    'ุฏูุฏุงูโูุง ุดุฑฺฉุชโฺฉููุฏู ุฑูุจุฑูุช ุฑุง ูุณูุงฺฉ ุจุฒู.',
    'ุงููู ฺฉูููโุง ฺฉู ุจู ุฐููุช ูโุฑุณุฏ ุฑุง ูุฑุงุฏ ุจุฒู.',
    'ฺฉ ุนุฏุฏ ููู ุชุฑุด ุจุฎูุฑ ู ูุงฺฉูุด ูุดุงู ูุฏู.',
    'ุจุง ุตุฏุง ุจููุฏ ฺฉ ุดุนุฑ ฺฉูุฏฺฉุงูู ุจุฎูุงู.',
    'ุจุฑุง 2 ุฏููู ุจู ุฒุจุงู ุญูุงูุงุช ุตุญุจุช ฺฉู.',
    'ุจุง ฺุดูโูุง ุจุณุชู ฺฉ ููุงุด ุจฺฉุด ู ูุดุงู ุจุฏู.',
    'ุจุง ุฏูุงู ุฎูุฏ ฺฉ ุขููฺฏ ุจููุงุฒ.',
    'ุจุฑุง 1 ุฏููู ุฑู ฺฉ ูพุง ุจุงุณุช.',
    'ฺฉ ุฏุงุณุชุงู ุฎูุฏูโุฏุงุฑ ุจุณุงุฒ ู ุชุนุฑู ฺฉู.',
    'ุจุง ุงุณุชูุงุฏู ุงุฒ ูุณุงู ููุฌูุฏ ฺฉ ฺฉูุงู ุจุณุงุฒ ู ุจุฑ ุณุฑ ุจฺฏุฐุงุฑ.',
    'ฺฉ ุฌูฺฉ ุชุนุฑู ฺฉู ฺฉู ููู ุจุฎูุฏูุฏ.',
    'ุจุง ุตุฏุง ฺฉ ุดุฎุตุช ฺฉุงุฑุชูู ุตุญุจุช ฺฉู.',
    'ุจุฑุง 30 ุซุงูู ุญุฑฺฉุงุช ูุฑุฒุด ุงูุฌุงู ุจุฏู.',
    'ฺฉ ุญุฑฺฉุช ุฑูุต ุฎูุฏูโุฏุงุฑ ุงูุฌุงู ุจุฏู.',
    'ุจุง ฺุดูุงู ุจุณุชู ฺฉ ุดุก ุฑุง ููุณ ฺฉู ู ุญุฏุณ ุจุฒู ฺุณุช.',
    'ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุดุงุก ุงุทุฑุงู ฺฉ ุณุงุฒ ุจุณุงุฒ ู ุจููุงุฒ.',
    'ฺฉ ุฌููู ุนุงุดูุงูู ุจู ุฒุจุงู ุฏฺฏุฑ ุจฺฏู.',
    'ุจุง ุตุฏุง ุจููุฏ ุจุฎูุฏ ุจุฏูู ุฏูู.',
    'ฺฉ ุญุฑฺฉุช ุฌุงูุจ ุจุง ุงูฺฏุดุชุงู ุฏุณุชุช ุงูุฌุงู ุจุฏู.',
    'ุจุฑุง 1 ุฏููู ุจุฏูู ูพูฺฉ ุฒุฏู ุจู ฺฉ ููุทู ุฎุฑู ุดู.',
    'ุจุง ฺฉ ุตุฏุง ุนุฌุจ ุตุญุจุช ฺฉู.',
    'ฺฉ ุฏุงุณุชุงู ุชุฑุณูุงฺฉ ฺฉูุชุงู ุชุนุฑู ฺฉู.',
    'ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุดุงุก ุงุทุฑุงู ฺฉ ูุฌุณูู ุจุณุงุฒ.',
    'ุจุฑุง 30 ุซุงูู ุจุฏูู ุญุฑฺฉุช ุจุงุณุช.',
    'ุจุง ุตุฏุง ุจููุฏ ูุงู ุฎูุฏ ุฑุง ุจฺฏู ู ุจูพุฑ.'
];

// --- ูุฏุฑุช ูุถุนุช ุจุงุฒ ---
// ูุดุฏุงุฑ: ุฏุฑ Serverless Functions Vercelุ ูุชุบุฑูุง ุณุฑุงุณุฑ ูุงููุฏ 'activeGames'
// ุชุถูู ููโุดููุฏ ฺฉู ุจู ูุฑุงุฎูุงูโูุง ุญูุธ ุดููุฏ. ุจุฑุง ูุฏุฑุช ูุถุนุช ูพุงุฏุงุฑ ุฏุฑ ูุญุท ุชููุฏุ
// ุจุงุฏ ุงุฒ ฺฉ ูพุงฺฏุงู ุฏุงุฏู ูพุงุฏุงุฑ (ูุงููุฏ Redis, MongoDB, PostgreSQL) ุงุณุชูุงุฏู ฺฉูุฏ.
const activeGames = {}; // { chatId: { player1: id, player2: id, turn: 1|2, mode: 'truth'|'dare'|'random', messageId: null } }

// ุชุงุจุน ฺฉูฺฉ ุจุฑุง ุจุฑุฑุณ ุนุถูุช ุฏุฑ ฺฉุงูุงู
const checkMembership = async (userId) => {
    if (!CHANNEL_USERNAME) {
        console.warn('CHANNEL_USERNAME ุชูุธู ูุดุฏู ุงุณุช. ุจุฑุฑุณ ุนุถูุช ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ.');
        return true; // ุงฺฏุฑ ฺฉุงูุงู ุชูุธู ูุดุฏู ุจุงุดุฏุ ูุฑุถ ูโฺฉูู ฺฉุงุฑุจุฑ ุนุถู ุงุณุช (ุจุฑุง ุชูุณุนู)
    }
    try {
        const chatMember = await bot.getChatMember(`@${CHANNEL_USERNAME}`, userId);
        const status = chatMember.status;
        return ['member', 'administrator', 'creator'].includes(status);
    } catch (e) {
        console.error(`ุฎุทุง ุฏุฑ ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ ${userId} ุฏุฑ ฺฉุงูุงู @${CHANNEL_USERNAME}:`, e.message);
        // ุงู ุฎุทุง ุงุบูุจ ุจู ุงู ูุนู ุงุณุช ฺฉู ุฑุจุงุช ุงุฏูู ฺฉุงูุงู ูุณุชุ ุง ูุฒุฑูู ฺฉุงูุงู ุงุดุชุจุงู ุงุณุช.
        return false;
    }
};

// ุชุงุจุน ฺฉูฺฉ ุจุฑุง ฺฉุจูุฑุฏ ููู ุงุตู
function mainMenu() {
    return {
        reply_markup: {
            keyboard: [['๐ฏ ุฌุฑุฃุช', '๐ง ุญููุช'], ['/2player'], ['๐ ุจุงุฒฺฏุดุช ุจู ุฎุงูู']],
            resize_keyboard: true // ฺฉุจูุฑุฏ ุฑุง ฺฉูฺฺฉุชุฑ ูโฺฉูุฏ
        }
    };
}

// ุชุงุจุน ฺฉูฺฉ ุจุฑุง ฺฉุจูุฑุฏ ุงููุงู ุฏุงุฎู ุจุงุฒ
function turnMessage(turn) {
    return {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: '๐ฒ ุณูุงู ุจุนุฏ', callback_data: 'next_question' },
                    { text: '๐ ุนูุถ ฺฉุฑุฏู ุญุงูุช', callback_data: 'switch_mode' }
                ],
                [{ text: 'โ ุฌูุงุจ ุฏุงุฏู', callback_data: 'answered' }],
                [{ text: 'โ ุชููู ุจุงุฒ', callback_data: 'stop_game' }]
            ]
        }
    };
}

// --- ุดูููุฏูโูุง ุฑูุฏุงุฏ ุจุงุช ุชูฺฏุฑุงู ---
// ุงู ุชูุงุจุน ฺฉ ุจุงุฑ ููฺฏุงู ุจุงุฑฺฏุฐุงุฑ ุงุณฺฉุฑูพุช ุชุนุฑู ูโุดููุฏ.
// bot.processUpdate(update) ุจุงุนุซ ูุนุงู ุดุฏู ุงู ุดูููุฏูโูุง ุจุฑ ุงุณุงุณ ุจูโุฑูุฒุฑุณุงู ูุฑูุฏ ูโุดูุฏ.

// ุฏุณุชูุฑ /start ุจุง ูพุงุฑุงูุชุฑ (ูุซูุงู /start join_12345) ุฑุง ููุฏู ูโฺฉูุฏ
bot.onText(/\/start (.+)/, async (msg, match) => {
    const chatId = msg.chat.id;
    const userId = msg.from.id;
    const commandParam = match[1]; // ูุซูุงู 'join_12345'

    const isMember = await checkMembership(userId);
    if (!isMember) {
        await bot.sendMessage(chatId, `ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุชุ ุงุจุชุฏุง ุนุถู ฺฉุงูุงู @${CHANNEL_USERNAME} ุดู:`, {
            reply_markup: {
                inline_keyboard: [
                    [{ text: '๐ข ูุฑูุฏ ุจู ฺฉุงูุงู', url: `https://t.me/${CHANNEL_USERNAME}` }],
                    [{ text: 'ุนุถู ุดุฏู โ', callback_data: 'check_membership' }]
                ]
            }
        });
        return;
    }

    if (commandParam && commandParam.startsWith('join_')) {
        const inviterId = parseInt(commandParam.split('_')[1], 10);

        // ุฌููฺฏุฑ ุงุฒ ุฏุนูุช ุฎูุฏ ุดุฎุต ุจู ุจุงุฒ
        if (inviterId === userId) {
            await bot.sendMessage(chatId, 'ููโุชูู ุฎูุฏุช ุฑู ุจู ุจุงุฒ ุฏุนูุช ฺฉู! ฺฉ ุฏูุณุช ุฑู ุฏุนูุช ฺฉู.');
            return;
        }

        const game = activeGames[inviterId];
        if (!game || game.player2) { // ุจุงุฒ ูพุฏุง ูุดุฏ ุง ูุจูุงู ุจุงุฒฺฉู ุฏูู ุฏุงุฑุฏ
            await bot.sendMessage(chatId, 'โ ููฺฉ ุจุงุฒ ูููุถ ุดุฏู ุง ุจุงุฒ ูุจูุงู ุดุฑูุน ุดุฏู ุงุณุช.');
            return;
        }

        // ุจุฑุฑุณ ุงูฺฉู ฺฉุงุฑุจุฑ ูุนู ุงุฒ ูุจู ุฏุฑ ฺฉ ุจุงุฒ ูุนุงู ุฏฺฏุฑ ูุจุงุดุฏ
        if (Object.values(activeGames).some(g => g.player1 === userId || g.player2 === userId)) {
            await bot.sendMessage(chatId, 'ุดูุง ุงุฒ ูุจู ุฏุฑ ฺฉ ุจุงุฒ ูุณุชุฏ! ูุทูุงู ุงุจุชุฏุง ุจุงุฒ ูุนู ุฑุง ูุชููู ฺฉูุฏ.');
            return;
        }

        game.player2 = userId; // ID ุจุงุฒฺฉู ุฏูู ุฑุง ุจู ุนููุงู ฺฉุงุฑุจุฑ ูุนู ุชูุธู ฺฉูุฏ
        game.turn = 1; // ููุจุช ุจุงุฒฺฉู ุงูู ุฑุง ุดุฑูุน ฺฉูุฏ
        // ูุถุนุช ุจุงุฒ ุฑุง ุจุฑุง ูุฑ ุฏู ุจุงุฒฺฉู ุฏุฑ activeGames ุฐุฎุฑู ฺฉูุฏ ุชุง ูุฑ ุฏู ุจุชูุงููุฏ ุขู ุฑุง ูพุฏุง ฺฉููุฏ
        activeGames[game.player1] = game;
        activeGames[game.player2] = game;

        await bot.sendMessage(game.player1, 'โ ุจุงุฒฺฉู ุฏูู ูพูุณุช! ุจุงุฒ ุดุฑูุน ุดุฏ.');
        await bot.sendMessage(game.player2, '๐ ูุงุฑุฏ ุจุงุฒ ุดุฏ! ุตุจุฑ ฺฉู ุชุง ููุจุชุช ุจุฑุณู.');

        // ุงุฑุณุงู ุงููู ุณูุงู ุจู ุจุงุฒฺฉู ุงูู
        const list = Math.random() > 0.5 ? truths : dares;
        const question = list[Math.floor(Math.random() * list.length)];
        const sentMsg = await bot.sendMessage(game.player1, `๐ฎ ููุจุช ุดูุงุณุช!\nโ ุณูุงู:\n${question}`, turnMessage(game.turn));
        game.messageId = sentMsg.message_id; // ุฐุฎุฑู ID ูพุงู ุจุฑุง ูุฑุงุดโูุง ุจุนุฏ
    } else {
        // ุงฺฏุฑ ููุท /start ุจุฏูู ูพุงุฑุงูุชุฑ ุจูุฏ
        await bot.sendMessage(chatId, 'ุณูุงู! ฺฉ ุงุฒ ฺฏุฒููโูุง ุฑู ุงูุชุฎุงุจ ฺฉู:', mainMenu());
    }
});

// ุฏุณุชูุฑ /start ุจุฏูู ูพุงุฑุงูุชุฑ ุฑุง ููุฏู ูโฺฉูุฏ
bot.onText(/^\/start$/, async (msg) => {
    const chatId = msg.chat.id;
    const userId = msg.from.id;

    const isMember = await checkMembership(userId);
    if (!isMember) {
        await bot.sendMessage(chatId, `ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุชุ ุงุจุชุฏุง ุนุถู ฺฉุงูุงู @${CHANNEL_USERNAME} ุดู:`, {
            reply_markup: {
                inline_keyboard: [
                    [{ text: '๐ข ูุฑูุฏ ุจู ฺฉุงูุงู', url: `https://t.me/${CHANNEL_USERNAME}` }],
                    [{ text: 'ุนุถู ุดุฏู โ', callback_data: 'check_membership' }]
                ]
            }
        });
        return;
    }
    await bot.sendMessage(chatId, 'ุณูุงู! ฺฉ ุงุฒ ฺฏุฒููโูุง ุฑู ุงูุชุฎุงุจ ฺฉู:', mainMenu());
});

// ุณุงุฑ ูพุงูโูุง ูุชู (ุฏฺฉููโูุง ุญููุชุ ุฌุฑุฃุชุ /2playerุ ุจุงุฒฺฏุดุช ุจู ุฎุงูู) ุฑุง ููุฏู ูโฺฉูุฏ
bot.on('message', async (msg) => {
    const chatId = msg.chat.id;
    const userId = msg.from.id;
    const text = msg.text;

    // ุฏุณุชูุฑุงุช /start ูุจูุงู ุชูุณุท onText(/start...) ููุฏู ุดุฏูโุงูุฏุ ุงูุฌุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ
    if (text && text.startsWith('/start')) return;
    if (msg.from.is_bot) return; // ูพุงูโูุง ุฎูุฏ ุจุงุช ุง ุจุงุชโูุง ุฏฺฏุฑ ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏ

    const isMember = await checkMembership(userId);
    if (!isMember) {
        // ุงู ุจุฑุฑุณ ูุจูุงู ุชูุณุท /start ุงูุฌุงู ุดุฏูุ ุงูุง ุจุฑุง ุณุงุฑ ูพุงูโูุง ูู ููุฏ ุงุณุช
        await bot.sendMessage(chatId, `ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุชุ ุงุจุชุฏุง ุนุถู ฺฉุงูุงู @${CHANNEL_USERNAME} ุดู:`, {
            reply_markup: {
                inline_keyboard: [
                    [{ text: '๐ข ูุฑูุฏ ุจู ฺฉุงูุงู', url: `https://t.me/${CHANNEL_USERNAME}` }],
                    [{ text: 'ุนุถู ุดุฏู โ', callback_data: 'check_membership' }]
                ]
            }
        });
        return;
    }

    // ุญุงูุช ุชฺฉ ููุฑู (ุฏฺฉููโูุง ุญููุช/ุฌุฑุฃุช)
    if (text === '๐ง ุญููุช') {
        const item = truths[Math.floor(Math.random() * truths.length)];
        await bot.sendMessage(chatId, `๐ง ุญููุช:\n${item}`, mainMenu());
        return;
    } else if (text === '๐ฏ ุฌุฑุฃุช') {
        const item = dares[Math.floor(Math.random() * dares.length)];
        await bot.sendMessage(chatId, `๐ฏ ุฌุฑุฃุช:\n${item}`, mainMenu());
        return;
    }

    // ุชูุธู ุญุงูุช ุจุงุฒ ุฏู ููุฑู
    if (text === '/2player') {
        // ุจุฑุฑุณ ฺฉูุฏ ฺฉู ฺฉุงุฑุจุฑ ุงุฒ ูุจู ุฏุฑ ฺฉ ุจุงุฒ ูุนุงู ูุจุงุดุฏ
        if (activeGames[userId] || Object.values(activeGames).some(g => g.player2 === userId && g.player1 !== userId)) {
            await bot.sendMessage(chatId, 'ุดูุง ุงุฒ ูุจู ุฏุฑ ฺฉ ุจุงุฒ ูุณุชุฏ! ูุทูุงู ุงุจุชุฏุง ุจุงุฒ ูุนู ุฑุง ูุชููู ฺฉูุฏ.', mainMenu());
            return;
        }
        activeGames[chatId] = { player1: chatId, player2: null, turn: 1, mode: 'random', messageId: null };
        await bot.sendMessage(chatId, '๐ฏ ุฏูุณุชุชู ุจู ุจุงุฒ ุฏุนูุช ฺฉู:', {
            reply_markup: {
                inline_keyboard: [[{ text: '๐ฅ ุฏุนูุช ุจู ุจุงุฒ', url: `https://t.me/${BOT_USERNAME}?start=join_${chatId}` }]]
            }
        });
        return;
    }

    // ุฏฺฉูู "ุจุงุฒฺฏุดุช ุจู ุฎุงูู" ุจุฑุง ููู ฺฉุงุฑุจุฑุงู ุฏุฑ ูุฑ ุญุงูุช
    if (text === '๐ ุจุงุฒฺฏุดุช ุจู ุฎุงูู') {
        const game = activeGames[userId] || Object.values(activeGames).find(g => g.player2 === userId);
        if (game) {
            // ุญุฐู ูุถุนุช ุจุงุฒ ุจุฑุง ูุฑ ุฏู ุจุงุฒฺฉู
            delete activeGames[game.player1];
            if (game.player2) delete activeGames[game.player2];
            // ุงุทูุงุน ุจู ูุฑ ุฏู ุจุงุฒฺฉู ุงฺฏุฑ ุจุงุฒ ุฏู ููุฑู ุจูุฏ
            await bot.sendMessage(game.player1, 'โ ุจุงุฒ ูุชููู ุดุฏ.', mainMenu());
            if (game.player2 && game.player2 !== game.player1) {
                await bot.sendMessage(game.player2, 'โ ุจุงุฒ ูุชููู ุดุฏ.', mainMenu());
            }
        }
        await bot.sendMessage(chatId, '๐ ุจุฑฺฏุดุช ุจู ููู ุงุตู.', mainMenu());
        return;
    }

    // ุงฺฏุฑ ูพุงูุ ฺฉ ุฏุณุชูุฑ ุง ุฏฺฉูู ููุฏู ุดุฏู ูุจูุฏ ู ุจุฎุด ุงุฒ ฺฉ ุจุงุฒ ูุนุงู ฒ ููุฑู ุจูุฏ
    const game = activeGames[userId]; // ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุงู ฺฉุงุฑุจุฑ ุจุงุฒฺฉู ุงูู ุง ุฏูู ุฏุฑ ฺฉ ุจุงุฒ ุงุณุช
    if (game) {
        const isTurn = (game.turn === 1 && userId === game.player1) ||
            (game.turn === 2 && userId === game.player2);

        if (isTurn) {
            const targetChatId = (game.player1 === userId) ? game.player2 : game.player1;
            if (targetChatId) {
                try {
                    await bot.forwardMessage(targetChatId, chatId, msg.message_id);
                    // ุงุฎุชุงุฑ: ุชุงุฏ ุงุฑุณุงู ูพุงู
                    // await bot.sendMessage(chatId, 'ูพุงู ุดูุง ุงุฑุณุงู ุดุฏ.');
                } catch (e) {
                    console.error('ุฎุทุง ุฏุฑ ููุฑูุงุฑุฏ ูพุงู:', e.message);
                    await bot.sendMessage(chatId, 'ุฎุทุง ุฏุฑ ุงุฑุณุงู ูพุงู ุจู ุจุงุฒฺฉู ุฏฺฏุฑ ุฑุฎ ุฏุงุฏ.');
                }
            }
        } else {
            await bot.sendMessage(chatId, 'ุงูุงู ููุจุช ุดูุง ูุณุช! โณ', { reply_to_message_id: msg.message_id });
        }
        return;
    }

    // ุจุงุฒฺฏุดุช ุจู ุญุงูุช ูพุดโูุฑุถ ุจุฑุง ูพุงูโูุง ูุงููููู
    await bot.sendMessage(chatId, 'ูุชูุฌู ูุดุฏู! ูุทูุง ุงุฒ ฺฏุฒููโูุง ุง ุฏุณุชูุฑุงุช ููุฌูุฏ ุงุณุชูุงุฏู ฺฉูุฏ.', mainMenu());
});

// ฺฉูฺฉโูุง ุฏฺฉููโูุง ุงููุงู ฺฉุจูุฑุฏ ุฑุง ููุฏู ูโฺฉูุฏ
bot.on('callback_query', async (query) => {
    const chatId = query.message.chat.id;
    const userId = query.from.id; // ฺฉุงุฑุจุฑ ฺฉู ุฑู ุฏฺฉูู ฺฉูฺฉ ฺฉุฑุฏ
    const data = query.data; // ุฑุดุชู callback_data

    // ุจุฑุฑุณ ุนุถูุช ุฏุฑ ฺฉุงูุงู ุฑุง ุงุจุชุฏุง ููุฏู ฺฉูุฏ
    if (data === 'check_membership') {
        const isMember = await checkMembership(userId);
        if (isMember) {
            await bot.answerCallbackQuery(query.id, { text: 'โ ุดูุง ุนุถู ฺฉุงูุงู ูุณุชุฏ!' });
            await bot.sendMessage(chatId, 'ุนุถูุช ุดูุง ุชุงุฏ ุดุฏ! ุญุงูุง ูโุชููุฏ ุงุฒ ุจุงุช ุงุณุชูุงุฏู ฺฉูุฏ.', mainMenu());
        } else {
            await bot.answerCallbackQuery(query.id, { text: 'ูููุฒ ุนุถู ฺฉุงูุงู ูุณุชุฏ ุง ุนุถูุช ุดูุง ุชุงุฏ ูุดุฏู ุงุณุช. ูุทูุง ุฏูุจุงุฑู ุงูุชุญุงู ฺฉูุฏ.' });
        }
        return;
    }

    // ูพุฏุง ฺฉุฑุฏู ุจุงุฒ ูุนุงู ฺฉู ุงู ฺฉุงุฑุจุฑ ุฏุฑ ุขู ุญุถูุฑ ุฏุงุฑุฏ
    const game = activeGames[userId] || Object.values(activeGames).find(g => g.player2 === userId);

    if (!game || (game.player1 !== userId && game.player2 !== userId)) {
        // ุงฺฏุฑ ุจุงุฒโุง ุจุฑุง ุงู ฺฉุงุฑุจุฑ ูพุฏุง ูุดุฏุ ุง ุฏฺฉูู ุงุฒ ฺฉ ุจุงุฒ ูุฏู/ูุงูุฑุจูุท ุงุณุช
        await bot.answerCallbackQuery(query.id, { text: 'ุจุงุฒโุง ูพุฏุง ูุดุฏ ุง ุงู ุฏฺฉูู ูุฑุจูุท ุจู ุจุงุฒ ุดูุง ูุณุช.' });
        return;
    }

    // ุจุฑุฑุณ ุงูฺฉู ุขุง ููุจุช ุจุงุฒฺฉู ูุนู ุงุณุช (ููุท ุจุฑุง ุงูุฏุงูุงุช ูุฑุจูุท ุจู ุจุงุฒุ ูู 'stop_game')
    const isTurn = (game.turn === 1 && userId === game.player1) ||
        (game.turn === 2 && userId === game.player2);

    if (!isTurn && data !== 'stop_game') { // 'stop_game' ุฑุง ูุฑ ฺฉุณ ุฏุฑ ุจุงุฒ ูโุชูุงูุฏ ฺฉูฺฉ ฺฉูุฏ
        await bot.answerCallbackQuery(query.id, { text: 'ุงูุงู ููุจุช ุดูุง ูุณุช! โณ' });
        return;
    }

    switch (data) {
        case 'next_question':
            const listForNextQ = game.mode === 'truth' ? truths : game.mode === 'dare' ? dares : (Math.random() > 0.5 ? truths : dares);
            const q = listForNextQ[Math.floor(Math.random() * listForNextQ.length)];

            try {
                await bot.editMessageText(`โ ุณูุงู:\n${q}`, {
                    chat_id: chatId, // ูพุงู ุฑุง ุฏุฑ ฺุช ูุนู ูุฑุงุด ฺฉูุฏ
                    message_id: query.message.message_id,
                    reply_markup: turnMessage(game.turn).reply_markup
                });
            } catch (error) {
                console.error("ุฎุทุง ุฏุฑ ูุฑุงุด ูพุงู ุจุฑุง ุณูุงู ุจุนุฏ:", error.message);
                // ุงฺฏุฑ ูพุงู ุจุฑุง ูุฑุงุด ุฎู ูุฏู ุจูุฏุ ฺฉ ูพุงู ุฌุฏุฏ ุจูุฑุณุชุฏ
                await bot.sendMessage(chatId, `โ ุณูุงู:\n${q}`, turnMessage(game.turn));
            }
            await bot.answerCallbackQuery(query.id);
            break;

        case 'switch_mode':
            game.mode = game.mode === 'truth' ? 'dare' : 'truth';
            await bot.answerCallbackQuery(query.id, { text: `ุชุบุฑ ุญุงูุช ุจู ${game.mode === 'truth' ? '๐ง ุญููุช' : '๐ฏ ุฌุฑุฃุช'}` });
            break;

        case 'answered':
            // ุชุบุฑ ููุจุช
            game.turn = game.turn === 1 ? 2 : 1;
            const nextPlayerChatId = game.turn === 1 ? game.player1 : game.player2;

            // ุชููุฏ ุณูุงู/ุฌุฑุฃุช ุจุนุฏ
            const qListForNextTurn = game.mode === 'truth' ? truths : game.mode === 'dare' ? dares : (Math.random() > 0.5 ? truths : dares);
            const q2 = qListForNextTurn[Math.floor(Math.random() * qListForNextTurn.length)];

            // ุงุฑุณุงู ุณูุงู ุฌุฏุฏ ุจู ุจุงุฒฺฉู ุจุนุฏ
            const sentMsgForNextTurn = await bot.sendMessage(nextPlayerChatId, `๐ฎ ููุจุช ุดูุงุณุช!\nโ ุณูุงู:\n${q2}`, turnMessage(game.turn));
            game.messageId = sentMsgForNextTurn.message_id; // ID ูพุงู ุฑุง ุจุฑุง ุณูุงู ุฌุฏุฏ ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ

            // ูุฑุงุด ูพุงู ุจุงุฒฺฉู ูุนู ุจุฑุง ุชุงุฏ ูพุงุณุฎ ู ููุงุด ฺฏุฒููโูุง ุญุฏุงูู
            try {
                await bot.editMessageText(`โ ุณูุงู ุฌูุงุจ ุฏุงุฏู ุดุฏ! ููุจุช ููุฑ ุจุนุฏ ุงุณุช.`, {
                    chat_id: chatId,
                    message_id: query.message.message_id,
                    reply_markup: { inline_keyboard: [[{ text: 'โ ุชููู ุจุงุฒ', callback_data: 'stop_game' }]] }
                });
            } catch (error) {
                console.error("ุฎุทุง ุฏุฑ ูุฑุงุด ูพุงู ุจุฑุง 'ุฌูุงุจ ุฏุงุฏู ุดุฏ':", error.message);
            }

            await bot.answerCallbackQuery(query.id, { text: 'ููุจุช ุชุบุฑ ฺฉุฑุฏ โ' });
            break;

        case 'stop_game':
            const player1ChatId = game.player1;
            const player2ChatId = game.player2;

            // ุญุฐู ูุถุนุช ุจุงุฒ ุจุฑุง ูุฑ ุฏู ุจุงุฒฺฉู ุงุฒ activeGames
            delete activeGames[player1ChatId];
            if (player2ChatId && player2ChatId !== player1ChatId) {
                delete activeGames[player2ChatId];
            }

            // ุงุทูุงุน ุจู ูุฑ ุฏู ุจุงุฒฺฉู ฺฉู ุจุงุฒ ูุชููู ุดุฏ
            await bot.sendMessage(player1ChatId, 'โ ุจุงุฒ ูุชููู ุดุฏ.', mainMenu());
            if (player2ChatId && player2ChatId !== player1ChatId) {
                await bot.sendMessage(player2ChatId, 'โ ุจุงุฒ ูุชููู ุดุฏ.', mainMenu());
            }

            // ุญุฐู ฺฉุจูุฑุฏ ุงููุงู ุงุฒ ูพุงู ฺฉู ุฏฺฉูู ฺฉูฺฉ ุดุฏ
            try {
                await bot.editMessageReplyMarkup(
                    { inline_keyboard: [[{ text: 'ุจุงุฒ ูุชููู ุดุฏ.', callback_data: 'stopped' }]] }, // ฺฉ ุฏฺฉูู ุฏุงู ุง ููุท ุฎุงู
                    { chat_id: chatId, message_id: query.message.message_id }
                );
            } catch (error) {
                console.warn("ููโุชูุงู ฺฉุจูุฑุฏ ูพุงู ุฑุง ุจุนุฏ ุงุฒ ุชููู ุจุงุฒ ูุฑุงุด ฺฉุฑุฏ:", error.message);
            }

            await bot.answerCallbackQuery(query.id, { text: 'ุจุงุฒ ูุชููู ุดุฏ.' });
            break;
    }
});

// --- ููุฏูุฑ ุงุตู ูุจโููฺฉ (ุจุฑุง Vercel ุตุงุฏุฑ ุดุฏู ุงุณุช) ---
module.exports = async (req, res) => {
    // ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ุฏุฑุฎูุงุณุช ุงุฒ ุชูฺฏุฑุงู ุงุฒ ููุน POST ุงุณุช
    if (req.method !== 'POST') {
        return res.status(200).send('ุงู ูุจโููฺฉ ููุท ุฏุฑุฎูุงุณุชโูุง POST ุฑุง ูโูพุฐุฑุฏ.');
    }

    // ุชูฺฏุฑุงู ุจูโุฑูุฒุฑุณุงูโูุง ุฑุง ุจู ุนููุงู JSON ุฏุฑ ุจุฏูู ุฏุฑุฎูุงุณุช ุงุฑุณุงู ูโฺฉูุฏ
    const update = req.body;

    // ููู: ุจูโุฑูุฒุฑุณุงู ุฑุง ุจุง ููููู ุจุงุช ูพุฑุฏุงุฒุด ฺฉูุฏ.
    // ุงู ฺฉุงุฑ ุดูููุฏูโูุง ููุงุณุจ ('onText', 'on("message")', ุง 'on("callback_query")') ุฑุง ูุนุงู ูโฺฉูุฏ.
    bot.processUpdate(update);

    // ุจูุงูุงุตูู ฺฉ ูพุงุณุฎ 200 OK ุงุฑุณุงู ฺฉูุฏ.
    // ุงู ุจู ุชูฺฏุฑุงู ูโฺฏูุฏ ฺฉู ุจูโุฑูุฒุฑุณุงู ุจุง ููููุช ุฏุฑุงูุช ุดุฏู ู ูุงุฒ ุจู ุงุฑุณุงู ูุฌุฏุฏ ุขู ูุณุช.
    // ูุฑ ุนููุงุช ุทููุงูโูุฏุช ุจุงุฏ ุจู ุตูุฑุช ูุงููุฒูุงู ูพุณ ุงุฒ ุงู ูพุงุณุฎ ุงูุฌุงู ุดูุฏ.
    res.status(200).send('OK');
};